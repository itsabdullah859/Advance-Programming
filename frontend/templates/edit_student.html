{% extends "base.html" %}

{% block title %}Edit Student - IntelliTrack{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Edit Student</h1>
                <p class="text-gray-600">Update student information for {{ student.name }}</p>
            </div>
            <a href="{{ url_for('view_students') }}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                <i class="fas fa-arrow-left mr-2"></i>Back to Students
            </a>
        </div>

        <!-- Form -->
        <div class="card-shadow bg-white rounded-xl p-8">
            <form method="POST" action="{{ url_for('edit_student', id=student.id) }}" class="space-y-8" id="editStudentForm">
                <!-- Personal Information -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-user mr-3 text-blue-600"></i>
                        Personal Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                                Full Name <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input
                                    type="text"
                                    id="name"
                                    name="name"
                                    required
                                    value="{{ student.name }}"
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200"
                                    placeholder="Enter student's full name"
                                >
                            </div>
                        </div>

                        <div>
                            <label for="roll_no" class="block text-sm font-semibold text-gray-700 mb-2">
                                Roll Number <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fas fa-id-card absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input
                                    type="text"
                                    id="roll_no"
                                    name="roll_no"
                                    required
                                    value="{{ student.roll_no }}"
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200"
                                    placeholder="e.g., 2024001"
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Academic Information -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-graduation-cap mr-3 text-green-600"></i>
                        Academic Information
                    </h3>
                    <div class="space-y-6">
                        <div>
                            <label for="class_id" class="block text-sm font-semibold text-gray-700 mb-2">
                                Class <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fas fa-school absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <select
                                    id="class_id"
                                    name="class_id"
                                    required
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200 bg-white"
                                >
                                    <option value="">Select a class</option>
                                    {% for class_info in classes %}
                                    <option value="{{ class_info.id }}" {% if class_info.id == student.class_id %}selected{% endif %}>{{ class_info.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>                        <div>
                            <label for="subjects" class="block text-sm font-semibold text-gray-700 mb-2">
                                Subjects <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fas fa-book absolute left-3 top-3 text-gray-400"></i>
                                <textarea
                                    id="subjects"
                                    name="subjects"
                                    required
                                    rows="3"
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200 resize-none"
                                    placeholder="Enter subjects separated by commas"
                                >{{ student.subjects }}</textarea>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Separate multiple subjects with commas</p>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-chart-line mr-3 text-purple-600"></i>
                        Performance Metrics
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="marks" class="block text-sm font-semibold text-gray-700 mb-2">
                                Overall Marks (%) <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fas fa-percentage absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input
                                    type="number"
                                    id="marks"
                                    name="marks"
                                    required
                                    min="0"
                                    max="100"
                                    value="{{ student.marks }}"
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200"
                                    placeholder="0-100"
                                >
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0%</span>
                                <span id="marksValue">{{ student.marks }}%</span>
                                <span>100%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="marksBar" class="h-2 rounded-full transition-all duration-300" style="width: {{ student.marks }}%"></div>
                            </div>
                        </div>

                        <div>
                            <label for="attendance" class="block text-sm font-semibold text-gray-700 mb-2">
                                Attendance (%) <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <i class="fas fa-calendar-check absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input
                                    type="number"
                                    id="attendance"
                                    name="attendance"
                                    required
                                    min="0"
                                    max="100"
                                    value="{{ student.attendance }}"
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200"
                                    placeholder="0-100"
                                >
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0%</span>
                                <span id="attendanceValue">{{ student.attendance }}%</span>
                                <span>100%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                <div id="attendanceBar" class="h-2 rounded-full transition-all duration-300" style="width: {{ student.attendance }}%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="border-t border-gray-200 pt-8">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button
                            type="submit"
                            class="flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-green-800 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl"
                        >
                            <i class="fas fa-save mr-2"></i>Update Student
                        </button>
                        <a
                            href="{{ url_for('view_students') }}"
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-200 transition-all duration-200 text-center"
                        >
                            <i class="fas fa-times mr-2"></i>Cancel
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- Current Information Summary -->
        <div class="mt-6 card-shadow bg-gray-50 border border-gray-200 rounded-xl p-6">
            <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                Current Student Information
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                <div>
                    <span class="text-gray-600">Name:</span>
                    <span class="font-medium text-gray-900 ml-2">{{ student.name }}</span>
                </div>
                <div>
                    <span class="text-gray-600">Roll No:</span>
                    <span class="font-medium text-gray-900 ml-2">{{ student.roll_no }}</span>
                </div>
                <div>
                    <span class="text-gray-600">Class:</span>
                    <span class="font-medium text-gray-900 ml-2">{{ student.class }}</span>
                </div>
                <div>
                    <span class="text-gray-600">Marks:</span>
                    <span class="font-medium text-gray-900 ml-2">{{ student.marks }}%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize progress bars on page load
document.addEventListener('DOMContentLoaded', function() {
    updateProgress('marks', {{ student.marks }});
    updateProgress('attendance', {{ student.attendance }});
});

// Real-time percentage updates
document.getElementById('marks').addEventListener('input', function() {
    updateProgress('marks', this.value);
});

document.getElementById('attendance').addEventListener('input', function() {
    updateProgress('attendance', this.value);
});

function updateProgress(type, value) {
    const percentage = Math.min(Math.max(value || 0, 0), 100);
    document.getElementById(type + 'Value').textContent = percentage + '%';
    const bar = document.getElementById(type + 'Bar');
    bar.style.width = percentage + '%';

    // Change color based on performance
    if (percentage >= 80) {
        bar.className = 'bg-green-600 h-2 rounded-full transition-all duration-300';
    } else if (percentage >= 60) {
        bar.className = 'bg-yellow-600 h-2 rounded-full transition-all duration-300';
    } else {
        bar.className = 'bg-red-600 h-2 rounded-full transition-all duration-300';
    }
}

// Form validation
document.getElementById('editStudentForm').addEventListener('submit', function(e) {
    const marks = parseInt(document.getElementById('marks').value);
    const attendance = parseInt(document.getElementById('attendance').value);

    if (marks < 0 || marks > 100) {
        alert('Marks must be between 0 and 100');
        e.preventDefault();
        return;
    }

    if (attendance < 0 || attendance > 100) {
        alert('Attendance must be between 0 and 100');
        e.preventDefault();
        return;
    }
});
</script>
{% endblock %}
